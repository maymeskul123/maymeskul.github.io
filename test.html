<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>python-telegram-bot Example WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!--
        <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    -->
</head>

<script>
    Telegram.WebApp.ready();
    function sendToTelegram() {
        const data = JSON.stringify({value: document.getElementById('userInput').value});
        Telegram.WebApp.sendData(data);
        Telegram.WebApp.close();
        <!--
        Telegram.WebApp.MainButton.setText('Send input to bot').show().onClick(function () {
            const data = JSON.stringify({value: document.getElementById('userInput').value});
       -->     
        })
    };
    var initData = Telegram.WebApp.initData || '';
    var initDataUnsafe = Telegram.WebApp.initDataUnsafe || {};

    function sendMessage(msg_id, with_webview) {
        if (!initDataUnsafe.query_id) {
            alert('WebViewQueryId not defined');
            return;
        }
        $('button').prop('disabled', true);
        $('#btn_status').text('Sending...').removeClass('ok err').show();
        $.ajax('/users/telegram-callback', {
            type: 'POST',
            data: {
                init_data: initData                
            },
            dataType: 'json',
            success: function (result) {
                $('button').prop('disabled', false);
                if (result.response) {
                    if (result.response.ok) {
                        $('#btn_status').html('Message sent successfully!').addClass('ok').show();
                    } else {
                        $('#btn_status').text(result.response.description).addClass('err').show();
                        alert(result.response.description);
                    }
                } else {
                    $('#btn_status').text('Unknown error').addClass('err').show();
                    alert('Unknown error');
                }
            },
            error: function (xhr) {
                $('button').prop('disabled', false);
                $('#btn_status').text('Server error').addClass('err').show();
                alert('Server error');
            }
        });
    }
</script>
<body style="background-color: #ffffff">
    <input type="text" id="userInput">
    <button onclick="sendMessage()">Send</button>
</body>
<script type="text/javascript">
    Telegram.WebApp.expand();
</script>
